<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Controle de Dinheiro</title>
  <link rel="icon" href="icon.png" type="image/png">  
  <style>
    :root {
      color-scheme: dark;
    }
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background-color: #121212;
      color: #ffffff;
      padding: 1rem;
    }
    h1, h2 {
      text-align: center;
    }
    .section {
      margin: 1rem 0;
      padding: 1rem;
      background-color: #1e1e1e;
      border-radius: 10px;
    }
    .panel {
      display: flex;
      justify-content: space-around;
      flex-wrap: wrap;
    }
    .panel div {
      margin: 1rem;
      font-size: 1.2rem;
    }
    label, input, select, button, textarea {
      display: block;
      width: 100%;
      margin-top: 0.5rem;
      margin-bottom: 1rem;
      font-size: 1rem;
    }
    button {
      padding: 0.5rem;
      background-color: #333;
      color: #fff;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }
    button:hover {
      background-color: #555;
    }
    #expenseDetailsList li {
      margin: 0.25rem 0;
    }
    .centrado {
      display: block;
      text-align: center;
      font-weight: bold;
    }
    .days-grid {
    display: flex;
    flex-wrap: wrap;
    gap: 0.5rem;
    margin-top: 0.5rem;
  }

  .day-tag {
    background-color: #333;
    padding: 0.4rem 0.6rem;
    border-radius: 8px;
    font-size: 0.9rem;
    color: #fff;
  }
  .day-tag.despesa { background-color: #f44336;} /* Vermelho para dias com despesa*/
  .day-tag.worked { background-color: #4caf50; } /* Verde para dias trabalhados */
  .day-tag.extra { background-color: #3639f4; } /* Azul para dias com receita extra */
  .day-tag.not-worked { background-color: #555; } /* Cinza para dias n√£o trabalhados */

  .day-tag.zero_saldo { background-color: #999; } /* Cinza para dias com saldo neutro */
  .day-tag.negativo { background-color: #aa0000; } /* Despesa > (sal√°rio + gorjeta || extra) */
  .day-tag.positivo { background-color: #0d8f00; } /* Sal√°rio + gorjeta > (despesa || extra) */
  .day-tag.extra_dominante { background-color: #1a1aff; } /* Extra > (sal√°rio + gorjeta || despesa) */
  .sumir {
    display: none;
  }
  .section:hover .sumir {
    display: block;
  }

  #btnTop {
    display: none;
    position: fixed;
    bottom: 1rem;
    right: 15px;
    z-index: 10;
    width: 48px;
    height: 48px;
    font-size: 22px;
    background-color: #fff;
    color: #000;
    border: none;
    border-radius: 10px;
    box-shadow: 0 2px 6px rgba(0,0,0,0.3);
    cursor: pointer;
    transition: opacity 0.3s;
    text-align: center;
    line-height: 48px; /* Centraliza verticalmente */
    padding: 0;
  }

  #btnTop:hover {
    background-color: #e6e6e6;
  }

  </style>
</head>
<body>

  <div id="birthdayBanner" class="hidden">
    <div class="fireworks"></div>
    <h2>üéâ Feliz Anivers√°rio! üéÇ</h2>
    <p>Que seu dia seja incr√≠vel e cheio de coisas boas! ü•≥</p>
  </div>

  <h1>Controle de Dinheiro</h1>

  <div class="section" id="values">
    <h2>Painel de Valores</h2>
    <div class="panel">
      <div>üíº Sal√°rio Total: ‚Ç¨<span id="salario">0</span></div>
      <div>üí∞ Gorjetas: ‚Ç¨<span id="gorjetas">0</span></div>
      <div>üí∂ Receita Extra: ‚Ç¨<span id="receita">0</span></div>
      <div>üßæ Total Geral: ‚Ç¨<span id="total">0</span></div>
    </div>
  </div>

  <div class="section" id="work-log">
    <h2>Registro Di√°rio</h2>
    <p>Voc√™ trabalhou hoje?</p>
    <button onclick="registerWork(true)">Sim</button>
    <button onclick="registerWork(false)">N√£o</button>
  </div>

  <div class="section" id="calendar-section">
    <h2>üìÜ Registrar Dia Espec√≠fico</h2>
    <label for="customWorkDate">Escolha a data:</label>
    <input type="date" id="customWorkDate">
    <button onclick="registerCustomWork()">Registrar dia trabalhado</button>
    <button onclick="registerCustomNotWork()">Registrar dia n√£o trabalhado</button>
  </div>

  <div class="sumir" id="work-log-list-section">
    <h2>Hist√≥rico de Dias Trabalhados</h2>
    <ul id="workLogList"></ul>
  </div>

  <div class="section">
    <h2>‚ûï Adicionar Receita Extra</h2>
    <label for="extraIncomeAmount">Valor</label>
    <input type="number" id="extraIncomeAmount" placeholder="Ex: 50">

    <label for="extraIncomeDesc">Descri√ß√£o</label>
    <input type="text" id="extraIncomeDesc" placeholder="Ex: venda, presente...">

    <label for="extraIncomeDate">Data</label>
    <input type="date" id="extraIncomeDate">

    <button onclick="addExtraIncome()">Adicionar Receita</button>
  </div>

  <div class="section">
    <h2>Adicionar Despesa</h2>
    <label for="expenseAmount">Valor</label>
    <input type="number" id="expenseAmount" placeholder="Ex: 10">
    <label for="expenseDesc">Descri√ß√£o</label>
    <input type="text" id="expenseDesc" placeholder="Ex: comida, transporte...">
    <label for="expenseSource">Origem do Dinheiro</label>
    <select id="expenseSource">
      <option value="salario">Sal√°rio</option>
      <option value="gorjetas">Gorjetas</option>
      <option value="receita">Receita Extra</option>
    </select>
    <button onclick="addExpense()">Adicionar Despesa</button>
  </div>

  <div class="section">
    <h2>üïí Registrar Despesa em Data Espec√≠fica</h2>
    <label for="customExpenseDate">Escolha a data:</label>
    <input type="date" id="customExpenseDate">

    <label for="customExpenseAmount">Valor</label>
    <input type="number" id="customExpenseAmount" placeholder="Ex: 10">

    <label for="customExpenseDesc">Descri√ß√£o</label>
    <input type="text" id="customExpenseDesc" placeholder="Ex: comida, transporte...">

    <label for="customExpenseSource">Origem do Dinheiro</label>
    <select id="customExpenseSource">
      <option value="salario">Sal√°rio</option>
      <option value="gorjetas">Gorjetas</option>
      <option value="receita">Receita Extra</option>
    </select>

    <button onclick="addCustomExpense()">Adicionar Despesa</button>
  </div>

  <div class="section" id="monthly-summary">
    <h2>üìä Resumo Mensal</h2>
    <div>
      <strong class="centrado">üóìÔ∏è Historico de Dias:</strong>
      <div id="workDaysGrid" class="days-grid"></div>
      <div id="dayDetail" class="section" style="display: none;">
      <h3>üìÖ Detalhes do dia: <span id="selectedDayLabel"></span></h3>
      <p><strong>Sal√°rio:</strong> ‚Ç¨<span id="detailSalary">0.00</span></p>
      <p><strong>Gorjetas:</strong> ‚Ç¨<span id="detailTip">0.00</span></p>
      <p><strong>Receita Extra:</strong> ‚Ç¨<span id="detailReceita">0.00</span></p>
      <p><strong>Despesas:</strong> ‚Ç¨<span id="detailExpense">0.00</span></p>
      <div>
        <strong>Detalhes das despesas:</strong>
        <ul id="detailExpenseList"></ul>
      </div>
      <p><strong>Total do dia:</strong> ‚Ç¨<span id="detailTotal">0.00</span></p>
    </div>
    <br>
    <strong class="centrado" id="currentMonthLabel"></strong>
    <script>
      const label = new Date().toLocaleString('default', { month: 'long', year: 'numeric' });
      document.getElementById('currentMonthLabel').innerText = label.charAt(0).toUpperCase() + label.slice(1);
    </script>
    <div style="display: flex; justify-content: space-between;">
      <button onclick="changeMonth(-1)">‚Üê M√™s anterior</button>
      <button onclick="changeMonth(1)">Pr√≥ximo m√™s ‚Üí</button>
    </div>
    <div id="monthDetails" style="margin-top: 1rem;">
      <p><strong>Dias trabalhados:</strong> <span id="monthWorkDays">0</span></p>
      <p><strong>Dias n√£o trabalhados:</strong> <span id="monthNotWorkDays">0</span></p>
      <p><strong>Sal√°rio total do m√™s:</strong> ‚Ç¨<span id="monthSalary">0.00</span></p>
      <p><strong>Gorjetas:</strong> ‚Ç¨<span id="monthTips">0.00</span></p>
      <p><strong>Receita Extra:</strong> ‚Ç¨<span id="monthReceita">0.00</span></p>
      <p><strong>Despesas:</strong> ‚Ç¨<span id="monthExpenses">0.00</span></p>
      <div>
        <strong>Detalhes das despesas:</strong>
        <ul id="expenseDetailsList"></ul>
      </div>
      <p><strong>Total do m√™s:</strong> ‚Ç¨<span id="monthTotal">0.00</span></p>
    </div>
  </div>

  <div class="section">
    <h2>üóëÔ∏è Remover Dados</h2>
    <label for="removerData">Escolha a data:</label>
    <input type="date" id="removerData">
    <label for="removerObs">Observa√ß√£o:</label>
    <input type="text" id="removerObs" placeholder="Ex: gym, jantar...">
    <button onclick="removerDespesasPorDataEObs()">üóëÔ∏è Remover despesas por data e observa√ß√£o</button>
    <button onclick="removerDiaTrabalhadoPorData()">‚õî Remover dia de trabalho</button>
    <button onclick="removerDespesasPorData()">üí∏ Remover despesas do dia</button>
    <button onclick="removerReceitaPorData()">üí∏ Remover receita extra do dia</button>
    <button onclick="removertodoodia()">üóëÔ∏è Remover todas as entradas do dia</button>
  </div>

  <button id="btnTop" onclick="scrollToTop()">‚ñ≤</button>

  <script>

    window.addEventListener("scroll", () => {
      const btn = document.getElementById("btnTop");
      if (document.documentElement.scrollTop > 100 || document.body.scrollTop > 100) {
        btn.style.display = "block";
      } else {
        btn.style.display = "none";
      }
    });

    function scrollToTop() {
      window.scrollTo({
        top: 0,
        behavior: 'smooth'
      });
    }

    let data = JSON.parse(localStorage.getItem('financeData')) || {
      salaryDays: 0,
      tips: [],
      expenses: [],
      extraIncomes: [],
      workLog: []
    };

    data.salaryDays = Number(data.salaryDays) || 0;
    data.tips = Array.isArray(data.tips) ? data.tips : [];
    data.workLog = Array.isArray(data.workLog) ? data.workLog : [];
    data.extraIncomes = Array.isArray(data.extraIncomes) ? data.extraIncomes : [];

    function saveData() {
      localStorage.setItem('financeData', JSON.stringify(data));
    }

    function updateDisplay() {
      const salaryTotal = data.salaryDays * 25;
      const tipsTotal = data.tips.reduce((sum, t) => sum + t.value, 0);

      const salaryExpenses = data.expenses.filter(e => e.source === 'salario')
        .reduce((sum, e) => sum + e.amount, 0);
      const tipsExpenses = data.expenses.filter(e => e.source === 'gorjetas')
        .reduce((sum, e) => sum + e.amount, 0);
      const receitaExpenses = data.expenses.filter(e => e.source === 'receita')
        .reduce((sum, e) => sum + e.amount, 0);

      let remainingSalary = Math.max(0, salaryTotal - salaryExpenses);
      let remainingTips = Math.max(0, tipsTotal - tipsExpenses);
      const extraIncomeTotal = Array.isArray(data.extraIncomes)
        ? data.extraIncomes.reduce((sum, e) => sum + e.amount, 0)
        : 0;
      let remainingReceita = Math.max(0, extraIncomeTotal - receitaExpenses);
      const grandTotal = remainingSalary + remainingTips + remainingReceita;

      document.getElementById('salario').innerText = remainingSalary.toFixed(2);
      document.getElementById('gorjetas').innerText = remainingTips.toFixed(2);
      document.getElementById('receita').innerText = remainingReceita.toFixed(2);
      document.getElementById('total').innerText = grandTotal.toFixed(2);

      const logList = document.getElementById('workLogList');
      logList.innerHTML = '';
      data.workLog
        .filter(d => d.worked)
        .sort((a, b) => new Date(b.date) - new Date(a.date))
        .forEach(d => {
          const [year, month, day] = d.date.split('-');
          const li = document.createElement('li');
          li.textContent = `${day}.${month}.${year}`;
          logList.appendChild(li);
        });
    }

    function registerWork(didWork) {
      const today = new Date().toISOString().split('T')[0];
      if (didWork) {
        if (!data.workLog.some(entry => entry.date === today)) {
          data.salaryDays++;
          data.workLog.push({ date: today, worked: true });
        }
        if (confirm('Voc√™ recebeu gorjeta hoje?')) {
          const tipStr = prompt('Quanto voc√™ recebeu de gorjeta?');
          if (tipStr !== null) {
            const tip = parseFloat(tipStr.replace(',', '.'));
            if (!isNaN(tip)) data.tips.push({ value: tip, date: today });
          }
        }
        saveData();
        updateDisplay();
        alert('Registro salvo!');
      } else {
        const motivo = prompt('Motivo para n√£o trabalhar hoje:');
        if (motivo) {
          data.workLog.push({ date: today, worked: false, reason: motivo });
        }
        alert('Dia registrado como n√£o trabalhado.');
        updateDisplay();
      }
    }

    function registerCustomWork() {
      const selectedDate = document.getElementById('customWorkDate').value;
      if (!selectedDate) return alert('Por favor, escolha uma data.');

      if (!data.workLog.some(d => d.date === selectedDate)) {
        data.salaryDays++;
        data.workLog.push({ date: selectedDate, worked: true });
        if (confirm('Voc√™ recebeu gorjeta nesse dia?')) {
          const tipStr = prompt('Quanto voc√™ recebeu de gorjeta?');
          if (tipStr !== null) {
            const tip = parseFloat(tipStr.replace(',', '.'));
            if (!isNaN(tip)) data.tips.push({ value: tip, date: selectedDate });
          }
        }
        saveData();
        updateDisplay();
        alert('Dia registrado com sucesso!');
      } else {
        alert('Esse dia j√° foi registrado.');
      }
    }

    function registerCustomNotWork() {
      const selectedDate = document.getElementById('customWorkDate').value;
      if (!selectedDate) return alert('Por favor, escolha uma data.');

      if (!data.workLog.some(d => d.date === selectedDate)) {        
        const motivo = prompt('Motivo para n√£o trabalhar hoje:');
        if (motivo) {
          data.workLog.push({ date: selectedDate, worked: false, reason: motivo });
        }
        saveData();
        alert('Dia registrado como n√£o trabalhado com sucesso!');
        updateDisplay();
      } else {
        alert('Esse dia j√° foi registrado.');
      }
    }
      
    document.getElementById('extraIncomeDate').value = new Date().toISOString().split('T')[0];
    function addExtraIncome() {
      const amount = parseFloat(document.getElementById('extraIncomeAmount').value.replace(',', '.'));
      const desc = document.getElementById('extraIncomeDesc').value;
      const date = document.getElementById('extraIncomeDate').value;

      if (!date) return alert('Escolha uma data.');
      if (isNaN(amount) || amount <= 0) return alert('Valor inv√°lido');

      data.extraIncomes.push({
        amount,
        desc,
        date
      });

      saveData();
      updateDisplay();
      updateMonthlySummary();
      alert('Receita extra adicionada!');
    }

    function addExpense() {

      const addId = confirm("Trabalhou hoje?\n Se sim, clique em 'OK'. Se n√£o, clique em 'Cancelar'.");

      if (addId == true){
        id="monthNotWorkDays"
      }

      const amount = parseFloat(document.getElementById('expenseAmount').value.replace(',', '.'));
      const desc = document.getElementById('expenseDesc').value;
      const source = document.getElementById('expenseSource').value;
      if (!isNaN(amount) && amount > 0) {
        data.expenses.push({
          amount,
          desc,
          source,
          date: new Date().toISOString().slice(0, 10)
        });
        saveData();
        updateDisplay();
        alert('Despesa adicionada!');
      } else {
        alert('Valor inv√°lido');
      }
    }

    function addCustomExpense() {
      const date = document.getElementById('customExpenseDate').value;
      const amount = parseFloat(document.getElementById('customExpenseAmount').value.replace(',', '.'));
      const desc = document.getElementById('customExpenseDesc').value;
      const source = document.getElementById('customExpenseSource').value;

      if (!date) return alert('Por favor, escolha uma data.');
      if (isNaN(amount) || amount <= 0) return alert('Valor inv√°lido');

      data.expenses.push({
        amount,
        desc,
        source,
        date
      });

      saveData();
      updateDisplay();
      updateMonthlySummary();
      alert('Despesa registrada!');
    }

    let currentMonthOffset = 0;

    function getMonthKey(offset = 0) {
      const now = new Date();
      now.setMonth(now.getMonth() + offset);
      return now.toISOString().slice(0, 7);
    }

    function changeMonth(direction) {
      currentMonthOffset += direction;
      updateMonthlySummary();
    }

    function updateMonthlySummary() {
      const monthKey = getMonthKey(currentMonthOffset);
      const [year, month] = monthKey.split('-');
      const label = new Date(`${monthKey}-01`).toLocaleString('pt-BR', { month: 'long', year: 'numeric' });
      document.getElementById('currentMonthLabel').textContent = label.charAt(0).toUpperCase() + label.slice(1);

      const workDays = data.workLog
        .filter(d => d.worked && d.date.startsWith(monthKey))
        .map(d => d.date);

      const notWorkDays = data.workLog
        .filter(d => !d.worked && d.date.startsWith(monthKey))
        .map(d => d.date);

      const monthTips = data.tips
        .filter(t => t.date && t.date.startsWith(monthKey))
        .reduce((sum, t) => sum + t.value, 0);
      document.getElementById('monthTips').textContent = monthTips.toFixed(2);

      const monthExtras = data.extraIncomes
        .filter(e => e.date && e.date.startsWith(monthKey))
        .reduce((sum, e) => sum + e.amount, 0);
      document.getElementById('monthReceita').textContent = monthExtras.toFixed(2);

      const monthExpenses = data.expenses.filter(e => e.date && e.date.startsWith(monthKey));
      const totalExpenses = monthExpenses.reduce((sum, e) => sum + e.amount, 0);
      document.getElementById('monthExpenses').textContent = totalExpenses.toFixed(2);

      const list = document.getElementById('expenseDetailsList');
      list.innerHTML = '';
      monthExpenses.forEach(e => {
        const li = document.createElement('li');
        li.innerHTML = `‚Ç¨${e.amount.toFixed(2)} - ${e.source}${e.desc ? ` - ${e.desc}` : ''}`;
        list.appendChild(li);
      });

      const monthSalary = workDays.length * 25;
      document.getElementById('monthSalary').textContent = monthSalary.toFixed(2);
      const grandTotal = monthSalary + monthTips + monthExtras - totalExpenses;
      document.getElementById('monthTotal').textContent = grandTotal.toFixed(2);

      document.getElementById('monthWorkDays').textContent = workDays.length;

      document.getElementById('monthNotWorkDays').textContent = notWorkDays.length;

      const grid = document.getElementById('workDaysGrid');
      grid.innerHTML = '';

      const workedDaysSet = new Set(workDays);
      const expenseDays = new Set(
        monthExpenses.map(e => e.date).filter(Boolean)
      );
      const extraDays = new Set(
        data.extraIncomes
          .filter(e => e.date && e.date.startsWith(monthKey))
          .map(e => e.date)
      );
      const notWorkedDaysSet = new Set(
        data.workLog
          .filter(d => typeof d === 'object' && d.date && !d.worked && d.date.startsWith(monthKey))
          .map(d => d.date)
      );

      const allDaysSet = new Set([
        ...workedDaysSet,
        ...expenseDays,
        ...extraDays,
        ...notWorkedDaysSet
      ]);

      Array.from(allDaysSet).sort().forEach(date => {
        const [year, month, day] = date.split('-');
        const tag = document.createElement('div');

        const salary = data.workLog.some(d => d.date === date && d.worked) ? 25 : 0;
        const tip = data.tips.filter(t => t.date === date).reduce((sum, t) => sum + t.value, 0);
        const extra = data.extraIncomes.filter(e => e.date === date).reduce((sum, e) => sum + e.amount, 0);
        const expense = data.expenses.filter(e => e.date === date).reduce((sum, e) => sum + e.amount, 0);

        const saldo = salary + tip + extra - expense;

        let className = 'day-tag';

        const isWorked = workedDaysSet.has(date);
        const isNotWorked = notWorkedDaysSet.has(date);

        if (isWorked)
          className += ' worked';

        if (isNotWorked && salary + tip + extra + expense == 0)
          className += ' not-worked';

        if (expense !== 0 && salary + tip + extra === 0) {
          className += ' despesa'; // Vermelho para dias com despesa
          id="monthNotWorkDays";

        } else if (extra !== 0 && salary + tip + expense === 0) {
          className += ' extra'; // Azul para dias com receita extra
          id="monthNotWorkDays";

        } else if (saldo === 0 && !isNotWorked) {
          className += ' zero_saldo'; // Cinza claro

        } else if ((expense > (salary + tip) && (salary + tip) != 0) && (expense > extra && extra != 0)) {
          className += ' negativo'; // Vermelho escuro

        } else if ((extra > (salary + tip) && (salary + tip) != 0) && (extra > expense && expense != 0)) {
          className += ' extra_dominante'; // Azul escuro

        } else if (((salary + tip) > expense && expense != 0) && ((salary + tip) > extra && extra != 0)) {
          className += ' positivo'; // Verde escuro

        } else if ((expense > (salary + tip) && (salary + tip) != 0) || (expense > extra && extra != 0)) {
          className += ' negativo'; // Vermelho escuro

        } else if ((extra > (salary + tip) && (salary + tip) != 0) || (extra > expense && expense != 0)) {
          className += ' extra_dominante'; // Azul escuro

        } else if (((salary + tip) > expense && expense != 0) || ((salary + tip) > extra && extra != 0)) {
          className += ' positivo'; // Verde escuro
        }

        tag.className = className;
        tag.textContent = `${day}/${month}`;
        tag.style.cursor = 'pointer';
        tag.onclick = () => showDayDetails(date);
        grid.appendChild(tag);
      });
    }

  let selectedDay = null; // Adicione esta vari√°vel global

  function showDayDetails(dateStr) {
    const dayDetailDiv = document.getElementById('dayDetail');
    // Se j√° est√° aberto para o mesmo dia, fecha
    if (selectedDay === dateStr && dayDetailDiv.style.display === 'block') {
      dayDetailDiv.style.display = 'none';
      selectedDay = null;
      return;
    }
    selectedDay = dateStr;

    const salary = data.workLog.some(d => d.date === dateStr && d.worked) ? 25 : 0;
    const tips = data.tips
      .filter(t => t.date === dateStr)
      .reduce((sum, t) => sum + t.value, 0);
    const receita = data.extraIncomes
      .filter(e => e.date === dateStr)
      .reduce((sum, e) => sum + e.amount, 0);

    
    const expenses = data.expenses.filter(e => e.date === dateStr);
    const totalExpenses = expenses.reduce((sum, e) => sum + e.amount, 0);

    document.getElementById('detailReceita').textContent = receita.toFixed(2);

    const total = salary + tips + receita - totalExpenses;
    document.getElementById('detailTotal').textContent = total.toFixed(2);

    document.getElementById('selectedDayLabel').textContent =
      new Date(dateStr).toLocaleDateString('pt-BR');
    document.getElementById('detailSalary').textContent = salary.toFixed(2);
    document.getElementById('detailTip').textContent = tips.toFixed(2);
    document.getElementById('detailExpense').textContent = totalExpenses.toFixed(2);
    document.getElementById('detailTotal').textContent = total.toFixed(2);

    const ul = document.getElementById('detailExpenseList');
    ul.innerHTML = '';
    expenses.forEach(e => {
      const li = document.createElement('li');
      li.textContent = `‚Ç¨${e.amount.toFixed(2)} - ${e.source}${e.desc ? ` - ${e.desc}` : ''}`;
      ul.appendChild(li);
    });

    dayDetailDiv.style.display = 'block';
  }

  function removerDiaTrabalhadoPorData() {
    const date = document.getElementById('removerData').value;
    if (!date) return alert("Escolha uma data.");

    if (!data.workLog.some(d => d.date === date && d.worked)) {
      return alert("Esse dia n√£o est√° registrado como trabalhado.");
    }

    const confirmacao = confirm(`Deseja remover o dia de trabalho em ${formatarData(date)}?`);
    if (confirmacao) {
      data.workLog = data.workLog.filter(d => d.date !== date);
      data.salaryDays = Math.max(0, data.salaryDays - 1);

      // Remove gorjetas desse dia
      data.tips = data.tips.filter(t => t.date !== date);

      saveData();
      updateDisplay();
      updateMonthlySummary();
      alert("Dia de trabalho removido.");
    }
  }

  function removerDespesasPorData() {
  const date = document.getElementById('removerData').value;
  if (!date) return alert("Escolha uma data.");
  const despesasDoDia = data.expenses.filter(e => e.date === date);
  if (despesasDoDia.length === 0) {
    return alert("Nenhuma despesa registrada nesse dia.");
  }
  const confirmacao = confirm(`Remover todas as despesas do dia ${formatarData(date)}?`);
    if (confirmacao) {
      data.expenses = data.expenses.filter(e => e.date !== date);
      saveData();
      updateDisplay();
      updateMonthlySummary();
      alert("Despesas removidas.");
    }
  }

  function removerReceitaPorData() {
    const date = document.getElementById('removerData').value;
    if (!date) return alert("Escolha uma data.");
    const receitasDoDia = data.extraIncomes.filter(e => e.date === date);
    if (receitasDoDia.length === 0) {
      return alert("Nenhuma receita extra registrada nesse dia.");
    }
    const confirmacao = confirm(`Remover todas as receitas extras do dia ${formatarData(date)}?`);
    if (confirmacao) {
      data.extraIncomes = data.extraIncomes.filter(e => e.date !== date);
      saveData();
      updateDisplay();
      updateMonthlySummary();
      alert("Receitas extras removidas.");
    }
  }

  function removertodoodia() {
    const date = document.getElementById('removerData').value;
    if (!date) return alert("Escolha uma data.");

    const confirmacao = confirm(`Remover todas as entradas do dia ${formatarData(date)}?`);
    if (confirmacao) {
      data.workLog = data.workLog.filter(d => d.date !== date);
      data.salaryDays = Math.max(0, data.salaryDays - 1);
      data.tips = data.tips.filter(t => t.date !== date);    // Remove gorjetas desse dia
      data.extraIncomes = data.extraIncomes.filter(e => e.date !== date);
      data.expenses = data.expenses.filter(e => e.date !== date);
      saveData();
      updateDisplay();
      updateMonthlySummary();
      alert("Entradas removidas.");
    }
  }

  function formatarData(dateStr) {
    return new Date(dateStr).toLocaleDateString('pt-BR');
  }

  function removerDespesasPorDataEObs() {
    const date = document.getElementById('removerData').value;
    const obs = document.getElementById('removerObs').value.trim().toLowerCase();

    if (!date || !obs) return alert("Preencha a data e a observa√ß√£o.");

    const despesasRemovidas = data.expenses.filter(e =>
      e.date === date && e.desc.toLowerCase() === obs
    );

    if (despesasRemovidas.length === 0) {
      return alert("Nenhuma despesa encontrada com essa data e observa√ß√£o.");
    }

    const confirmacao = confirm(`Remover ${despesasRemovidas.length} despesa(s) do dia ${formatarData(date)} com observa√ß√£o "${obs}"?`);
    if (confirmacao) {
      data.expenses = data.expenses.filter(e =>
        !(e.date === date && e.desc.toLowerCase() === obs)
      );
      saveData();
      updateDisplay();
      updateMonthlySummary();
      alert("Despesas removidas.");
    }
  }

    // Inicializa√ß√£o
    updateDisplay();
    updateMonthlySummary();
    document.getElementById('customWorkDate').value = new Date().toISOString().split('T')[0];
    document.getElementById('customExpenseDate').value = new Date().toISOString().split('T')[0];
  </script>
  <style>
    #birthdayBanner {
      position: relative;
      background: linear-gradient(135deg, #22aa00, #3e0acc);
      color: white;
      text-align: center;
      padding: 2rem 1rem;
      border-radius: 15px;
      margin-bottom: 1.5rem;
      animation: pulse 2s infinite;
      box-shadow: 0 0 20px rgba(255, 255, 255, 0.3);
    }

    #birthdayBanner h2 {
      font-size: 2rem;
      margin: 0.5rem 0;
    }

    #birthdayBanner p {
      margin: 0;
      font-size: 1.2rem;
    }

    .hidden {
      display: none;
    }

    @keyframes pulse {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.02); }
    }

    /* Fogos simples */
    .fireworks {
      position: absolute;
      top: -20px;
      left: 50%;
      transform: translateX(-50%);
      width: 100px;
      height: 100px;
      background: radial-gradient(circle, #fff 10%, transparent 11%) center/10px 10px;
      animation: explode 1s infinite ease-in-out;
      opacity: 0.5;
    }

    @keyframes explode {
      0% { transform: translateX(-50%) scale(0.8); opacity: 0.2; }
      50% { transform: translateX(-50%) scale(1.5); opacity: 1; }
      100% { transform: translateX(-50%) scale(0.8); opacity: 0.2; }
    }
  </style>
  <script>
  // üéâ Mensagem de anivers√°rio
  function checkBirthday() {
    const today = new Date();
    const day = today.getDate();
    const month = today.getMonth() + 1; // janeiro = 0
    const banner = document.getElementById('birthdayBanner');

    if (day === 20 && month === 7) {
      banner.classList.remove('hidden');
    }
  }

  checkBirthday(); // chama quando carregar
  </script>
</body>
</html>